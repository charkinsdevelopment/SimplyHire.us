@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.Owin;
@model SimplyHireWeb.Models.UserSkillsViewModel

@{
    ViewBag.Title = "Profile";
    bool isAuthed = (System.Web.HttpContext.Current.User != null) && System.Web.HttpContext.Current.User.Identity.IsAuthenticated;
    var user = System.Web.HttpContext.Current.GetOwinContext().GetUserManager<ApplicationUserManager>().FindById(System.Web.HttpContext.Current.User.Identity.GetUserId());
}

<style>
    .modal-form{
        background:#fff;
        padding:15px;
    }
</style>

<section class="section">
    <div class="columns">
        <div class="column">
            <h2 class="title is-3">Profile</h2>
            <div class="field">
                <label class="label">Username</label>
                <div class="control">
                    <p>@user.UserName</p>
                </div>
                <a href="#">Reset Password</a>
            </div>
            @using (Html.BeginForm("UpdateProfile", "Account", FormMethod.Post, new { @class = "", role = "form" }))
            {
                @Html.AntiForgeryToken()
                <div class="field">
                    <label class="label required">First Name</label>
                    <p class="control">
                        @Html.TextBox("FirstName", user.FirstName, new { @class = "input", @required = "required" })
                    </p>
                </div>
                <label class="label required">Last Name</label>
                <div class="field">
                    <p class="control">
                        @Html.TextBox("LastName", user.LastName, new { @class = "input", @required = "required" })
                    </p>
                </div>

                <label class="label required">Email Address</label>
                <div class="field">
                    <p class="control">
                        @Html.TextBox("Email", user.Email, new { @class = "input", @required = "required" })
                    </p>
                </div>

                <label class="label required">Phone Number</label>
                <div class="field">
                    <p class="control">
                        @Html.TextBox("PhoneNumber", user.PhoneNumber, new { @class = "input", @required = "required" })
                    </p>
                </div>

                <div class="field">
                    <div class="control">
                        <input type="submit" class="button is-info" value="Save" />
                    </div>
                </div>
            }
        </div>
        <div class="column">
            <h2 class="title is-3">My Skills</h2>
            <p>Add your top 5 most marketable skills.</p>
            <table class="is-striped table">
                <thead>
                    <tr>
                        <th>Skill</th>
                        <th>Exp Level</th>
                        <th>Years of Exp.</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>

                @foreach (var skill in Model.Skills)
                {
                    <tr>
                        <td>@skill.Name</td>
                        <td>@skill.SkillLevel</td>
                        <td>@skill.YearsExperience</td>
                        <td><a href="#">Edit</a></td>
                        <td><a href="#">Delete</a></td>
                    </tr>
                }
                @if (Model.Skills.Count == 0)
                {
                    <tr>
                        <td>No Skills Yet. <a class="add-modal-skill" href="#">Click Here to Add Skills</a></td>
                    </tr>
                }
            </table>
        </div>
    </div>
</section>

<div id="SkillModal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <section class="section">
            <div class="modal-form">
                @using (Html.BeginForm("UpdateSkills", "Skills", FormMethod.Post, new { @class = "", role = "form" }))
                {
                    <h2 class="title is-3">Add New Skill</h2>
                    @Html.AntiForgeryToken()

                    <div class="field">
                        <label class="label required">Skill Name</label>
                        <div class="control">
                            @Html.TextBox("SkillName", "", new { @class = "input", required = "required", placeholder = "Skill Name" })
                        </div>
                        <p class="is-success suggestion-text"></p>
                    </div>

                    <div class="field">
                        <label class="label required">Skill Level</label>
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="skill" value="1" checked>
                                1
                            </label>
                            <label class="radio">
                                <input type="radio" name="skill" value="2">
                                2
                            </label>
                            <label class="radio">
                                <input type="radio" name="skill" value="3">
                                3
                            </label>
                            <label class="radio">
                                <input type="radio" name="skill" value="4">
                                4
                            </label>
                            <label class="radio">
                                <input type="radio" name="skill" value="5">
                                5
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label required">Experience In Years</label>
                        <div class="control">
                            @Html.TextBox("SkillExperience", "", new { @class = "input", required = "required", placeholder = "Years Experience", type="Number", @min="0", @max="99" })
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <input id="SaveSkillButton" type="submit" class="button is-info" value="Save" />
                        </div>
                    </div>
                }
            </div>
        </section>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>

<script>
    window.onload = function () {
        $(".add-modal-skill").click(function () {
            $("#SkillModal").addClass("is-active");
        });

        $(".modal-close").click(function () {
            $("#SkillModal").removeClass("is-active");
        });
        const SetSkillName = (skill) => {
            $('#SkillName').val(skill);
        }
        $('#SkillName').on('keyup', function () {
            setTimeout(function () {
                $.post('/Skills/GetSuggestedSkills', { skillname: $('#SkillName').val() }).done(function (response) {
                    if (response == null) $('.suggestion-text').text('');
                    if (response.resultCount == 0) {
                        $('.suggestion-text').text('This skill has never existed before! Way to go trend setter!');
                    } else {
                        $('.suggestion-text').text('Did you mean <a href="#" onclick="SetSkillName(${ response.skillName })">${ response.skillName }</a>');
                    }
                });
            }, 1000);
            
        });
    }
</script>